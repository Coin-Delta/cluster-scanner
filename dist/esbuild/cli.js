#!/usr/bin/env node
"use strict";(()=>{var O=Object.create;var c=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var M=Object.getOwnPropertyNames,w=Object.getOwnPropertySymbols,N=Object.getPrototypeOf,v=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var x=(n,e,t)=>e in n?c(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,I=(n,e)=>{for(var t in e||(e={}))v.call(e,t)&&x(n,t,e[t]);if(w)for(var t of w(e))E.call(e,t)&&x(n,t,e[t]);return n};var T=(n=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(n,{get:(e,t)=>(typeof require!="undefined"?require:e)[t]}):n)(function(n){if(typeof require!="undefined")return require.apply(this,arguments);throw new Error('Dynamic require of "'+n+'" is not supported')});var V=(n,e,t,p)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of M(e))!v.call(n,r)&&r!==t&&c(n,r,{get:()=>e[r],enumerable:!(p=S(e,r))||p.enumerable});return n};var h=(n,e,t)=>(t=n!=null?O(N(n)):{},V(e||!n||!n.__esModule?c(t,"default",{value:n,enumerable:!0}):t,n));var s=(n,e,t)=>new Promise((p,r)=>{var o=i=>{try{a(t.next(i))}catch(m){r(m)}},y=i=>{try{a(t.throw(i))}catch(m){r(m)}},a=i=>i.done?p(i.value):Promise.resolve(i.value).then(o,y);a((t=t.apply(n,e)).next())});var C=h(T("figlet"));var b={name:"cluster-scanner",version:"0.0.1",description:"Library to find the latest validators cluster snapshot in the SSV Contract.",author:"SSV.Network",repository:"https://github.com/bloxapp/cluster-scanner",license:"MIT",keywords:["ssv","ssv.network","cluster","scanner"],main:"./dist/tsc/src/main.js",types:"./dist/tsc/src/main.d.ts",engines:{node:">=12"},scripts:{"dev:cli":"ts-node src/cli.ts",lint:"eslint src/ --ext .js,.jsx,.ts,.tsx",clean:"rm -rf dist build package","ts-node":"ts-node",build:"tsc -p tsconfig.json","build-all":"yarn clean && yarn build && yarn esbuild",esbuild:"node ./esbuild.js","pre-commit":"yarn test && yarn lint && yarn build-all"},devDependencies:{"@testing-library/jest-dom":"^5.16.4","@types/argparse":"^2.0.10","@types/jest":"^26.0.24","@types/node":"^15.14.9","@typescript-eslint/eslint-plugin":"^4.33.0","@typescript-eslint/parser":"^4.33.0",esbuild:"^0.14.38","esbuild-node-externals":"^1.4.1",eslint:"^7.32.0",husky:"^7.0.4",jest:"^26.6.3","jest-environment-jsdom":"^26.6.2","jest-environment-node":"^26.6.2","jest-environment-uint8array":"^1.0.0","jest-watch-typeahead":"0.6.5",jsdom:"^16.5.3","jsdom-global":"^3.0.2",pkg:"^5.7.0","ts-jest":"^26.5.6","ts-node":"^10.9.1",typedoc:"^0.22.15",typescript:"^4.6.4"},dependencies:{"@types/figlet":"^1.5.4","@types/underscore":"^1.11.4","@types/yargs":"^17.0.12",argparse:"^2.0.1",assert:"^2.0.0","class-validator":"^0.13.2",colors:"^1.4.0",events:"^3.3.0",figlet:"^1.5.2",minimist:"^1.2.6",web3:"^1.8.1"},licenses:[{MIT:"SEE LICENSE IN LICENCE FILE"}]};var F=T("argparse");var g=h(T("web3"));var k=[{inputs:[],name:"ApprovalNotWithinTimeframe",type:"error"},{inputs:[],name:"BurnRatePositive",type:"error"},{inputs:[],name:"CallerNotOwner",type:"error"},{inputs:[],name:"ClusterAlreadyEnabled",type:"error"},{inputs:[],name:"ClusterDoesNotExists",type:"error"},{inputs:[],name:"ClusterIsLiquidated",type:"error"},{inputs:[],name:"ClusterLiquidatable",type:"error"},{inputs:[],name:"ClusterNotLiquidatable",type:"error"},{inputs:[],name:"ExceedValidatorLimit",type:"error"},{inputs:[],name:"FeeExceedsIncreaseLimit",type:"error"},{inputs:[],name:"FeeTooLow",type:"error"},{inputs:[],name:"IncorrectClusterState",type:"error"},{inputs:[],name:"InsufficientBalance",type:"error"},{inputs:[],name:"InsufficientFunds",type:"error"},{inputs:[],name:"InvalidOperatorIdsLengthuctureInvalid",type:"error"},{inputs:[],name:"InvalidPublicKeyLength",type:"error"},{inputs:[],name:"NewBlockPeriodIsBelowMinimum",type:"error"},{inputs:[],name:"NoFeeDelcared",type:"error"},{inputs:[],name:"NoValidatorOwnership",type:"error"},{inputs:[],name:"OperatorDoesNotExist",type:"error"},{inputs:[],name:"ParametersMismatch",type:"error"},{inputs:[],name:"UnsortedOperatorsList",type:"error"},{inputs:[],name:"ValidatorAlreadyExists",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],indexed:!1,internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"ClusterDeposit",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],indexed:!1,internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"ClusterLiquidated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],indexed:!1,internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"ClusterReactivated",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{indexed:!1,internalType:"uint256",name:"value",type:"uint256"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],indexed:!1,internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"ClusterWithdrawn",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"value",type:"uint64"}],name:"DeclareOperatorFeePeriodUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"value",type:"uint64"}],name:"ExecuteOperatorFeePeriodUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"address",name:"recipientAddress",type:"address"}],name:"FeeRecipientAddressUpdated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint8",name:"version",type:"uint8"}],name:"Initialized",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"value",type:"uint64"}],name:"LiquidationThresholdPeriodUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"value",type:"uint256"},{indexed:!1,internalType:"address",name:"recipient",type:"address"}],name:"NetworkEarningsWithdrawn",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"oldFee",type:"uint256"},{indexed:!1,internalType:"uint256",name:"newFee",type:"uint256"}],name:"NetworkFeeUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"id",type:"uint64"},{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"bytes",name:"publicKey",type:"bytes"},{indexed:!1,internalType:"uint256",name:"fee",type:"uint256"}],name:"OperatorAdded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64",name:"operatorId",type:"uint64"}],name:"OperatorFeeCancelationDeclared",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64",name:"operatorId",type:"uint64"},{indexed:!1,internalType:"uint256",name:"blockNumber",type:"uint256"},{indexed:!1,internalType:"uint256",name:"fee",type:"uint256"}],name:"OperatorFeeDeclaration",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64",name:"operatorId",type:"uint64"},{indexed:!1,internalType:"uint256",name:"blockNumber",type:"uint256"},{indexed:!1,internalType:"uint256",name:"fee",type:"uint256"}],name:"OperatorFeeExecution",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"value",type:"uint64"}],name:"OperatorFeeIncreaseLimitUpdate",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"id",type:"uint64"},{indexed:!1,internalType:"uint64",name:"fee",type:"uint64"}],name:"OperatorFeeSet",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"id",type:"uint64"}],name:"OperatorRemoved",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"value",type:"uint256"},{indexed:!1,internalType:"uint64",name:"operatorId",type:"uint64"},{indexed:!1,internalType:"address",name:"owner",type:"address"}],name:"OperatorWithdrawn",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"previousOwner",type:"address"},{indexed:!0,internalType:"address",name:"newOwner",type:"address"}],name:"OwnershipTransferred",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{indexed:!1,internalType:"bytes",name:"publicKey",type:"bytes"},{indexed:!1,internalType:"bytes",name:"shares",type:"bytes"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],indexed:!1,internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"ValidatorAdded",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"owner",type:"address"},{indexed:!1,internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{indexed:!1,internalType:"bytes",name:"publicKey",type:"bytes"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],indexed:!1,internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"ValidatorRemoved",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint64",name:"value",type:"uint64"}],name:"ValidatorsPerOperatorLimitUpdate",type:"event"},{inputs:[{internalType:"uint64",name:"operatorId",type:"uint64"}],name:"cancelDeclaredOperatorFee",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"operatorId",type:"uint64"},{internalType:"uint256",name:"fee",type:"uint256"}],name:"declareOperatorFee",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{internalType:"uint256",name:"amount",type:"uint256"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"deposit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{internalType:"uint256",name:"amount",type:"uint256"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"deposit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"operatorId",type:"uint64"}],name:"executeOperatorFee",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"getBalance",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"}],name:"getClusterBurnRate",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getDeclaredOperatorFeePeriod",outputs:[{internalType:"uint64",name:"",type:"uint64"}],stateMutability:"view",type:"function"},{inputs:[],name:"getExecuteOperatorFeePeriod",outputs:[{internalType:"uint64",name:"",type:"uint64"}],stateMutability:"view",type:"function"},{inputs:[],name:"getLiquidationThresholdPeriod",outputs:[{internalType:"uint64",name:"",type:"uint64"}],stateMutability:"view",type:"function"},{inputs:[],name:"getNetworkEarnings",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getNetworkFee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64",name:"operatorId",type:"uint64"}],name:"getOperatorById",outputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint256",name:"fee",type:"uint256"},{internalType:"uint32",name:"validatorCount",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64",name:"operatorId",type:"uint64"}],name:"getOperatorDeclaredFee",outputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64",name:"id",type:"uint64"}],name:"getOperatorEarnings",outputs:[{internalType:"uint64",name:"currentBlock",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint256",name:"balance",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64",name:"operatorId",type:"uint64"}],name:"getOperatorFee",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[],name:"getOperatorFeeIncreaseLimit",outputs:[{internalType:"uint64",name:"",type:"uint64"}],stateMutability:"view",type:"function"},{inputs:[],name:"getValidatorsPerOperatorLimit",outputs:[{internalType:"uint64",name:"",type:"uint64"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"contract IERC20",name:"token_",type:"address"},{internalType:"uint64",name:"operatorMaxFeeIncrease_",type:"uint64"},{internalType:"uint64",name:"declareOperatorFeePeriod_",type:"uint64"},{internalType:"uint64",name:"executeOperatorFeePeriod_",type:"uint64"},{internalType:"uint64",name:"minimumBlocksBeforeLiquidation_",type:"uint64"},{internalType:"uint64",name:"validatorsPerOperatorLimit_",type:"uint64"}],name:"initialize",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"isLiquidatable",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"isLiquidated",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"owner",type:"address"},{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"liquidate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"owner",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{internalType:"uint256",name:"amount",type:"uint256"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"reactivate",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"publicKey",type:"bytes"},{internalType:"uint256",name:"fee",type:"uint256"}],name:"registerOperator",outputs:[{internalType:"uint64",name:"id",type:"uint64"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"publicKey",type:"bytes"},{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{internalType:"bytes",name:"sharesEncrypted",type:"bytes"},{internalType:"uint256",name:"amount",type:"uint256"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"registerValidator",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"id",type:"uint64"}],name:"removeOperator",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"publicKey",type:"bytes"},{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"removeValidator",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"renounceOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"recipientAddress",type:"address"}],name:"setFeeRecipientAddress",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"newOwner",type:"address"}],name:"transferOwnership",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"newDeclareOperatorFeePeriod",type:"uint64"}],name:"updateDeclareOperatorFeePeriod",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"newExecuteOperatorFeePeriod",type:"uint64"}],name:"updateExecuteOperatorFeePeriod",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"blocks",type:"uint64"}],name:"updateLiquidationThresholdPeriod",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"fee",type:"uint256"}],name:"updateNetworkFee",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"newOperatorMaxFeeIncrease",type:"uint64"}],name:"updateOperatorFeeIncreaseLimit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"limit",type:"uint64"}],name:"updateValidatorsPerOperatorLimit",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64[]",name:"operatorIds",type:"uint64[]"},{internalType:"uint256",name:"amount",type:"uint256"},{components:[{internalType:"uint32",name:"validatorCount",type:"uint32"},{internalType:"uint64",name:"networkFee",type:"uint64"},{internalType:"uint64",name:"networkFeeIndex",type:"uint64"},{internalType:"uint64",name:"index",type:"uint64"},{internalType:"uint64",name:"balance",type:"uint64"},{internalType:"bool",name:"disabled",type:"bool"}],internalType:"struct ISSVNetwork.Cluster",name:"cluster",type:"tuple"}],name:"withdraw",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdrawNetworkEarnings",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"operatorId",type:"uint64"},{internalType:"uint256",name:"amount",type:"uint256"}],name:"withdrawOperatorEarnings",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint64",name:"operatorId",type:"uint64"}],name:"withdrawOperatorEarnings",outputs:[],stateMutability:"nonpayable",type:"function"}];var l=class{static web3(e){return new g.default(e)}static get abi(){return k}static contract(e,t){return new(l.web3(e)).eth.Contract(l.abi,t)}},u=l;u.BLOCK_RANGE_500K=5e5;var d=class{constructor(){this.DAY=5400;this.WEEK=this.DAY*7;this.MONTH=this.DAY*30;this.eventsList=["ClusterDeposit","ClusterWithdrawn","ValidatorRemoved","ValidatorAdded","ClusterLiquidated","ClusterReactivated"];let e=new F.ArgumentParser;e.add_argument("-n","--node-url",{help:"The ETH1 node url.",required:!0,dest:"nodeUrl"}),e.add_argument("-ca","--ssv-contract-address",{help:"The SSV Contract address, used to find the latest cluster data snapshot. Refer to https://docs.ssv.network/developers/smart-contracts",required:!0,dest:"contractAddress"}),e.add_argument("-oa","--owner-address",{help:"The liquidator's recipient address private key, used for creating a liquidation transaction",required:!0,dest:"ownerAddress"}),e.add_argument("-oids","--operator-ids",{help:"Comma-separated list of operators IDs from the contract in the same sequence as you provided operators itself",required:!0,dest:"operatorIds"}),this.params=e.parse_args(),this.params.operatorIds=this.params.operatorIds.split(",").map(t=>{if(Number.isNaN(+t))throw new Error("Operator Id should be the number");return+t})}execute(){return s(this,null,function*(){let e=yield this.getClusterSnapshot(this.MONTH,yield u.web3(this.params.nodeUrl).eth.getBlockNumber());return{params:I({},this.params),cluster:JSON.stringify(e)}})}getClusterSnapshot(e,t){return s(this,null,function*(){let p={fromBlock:t-e,toBlock:t,filter:{owner:this.params.ownerAddress}},r=[];try{if(p.fromBlock<=0)return null;r=yield u.contract(this.params.nodeUrl,this.params.contractAddress).getPastEvents("allEvents",p)}catch(a){console.error(a);let i;e===this.MONTH?i=this.WEEK:e===this.WEEK&&(i=this.DAY),r=yield this.getClusterSnapshot(i,t)}let o=null,y=0;return r.filter(a=>this.eventsList.includes(a.event)).filter(a=>JSON.stringify(a.returnValues.operatorIds.map(i=>+i))===JSON.stringify(this.params.operatorIds)).forEach(a=>{a.blockNumber>y&&(y=a.blockNumber,o=a.returnValues.cluster)}),o||(yield this.getClusterSnapshot(this.MONTH,t-e))})}};var A=n=>s(void 0,null,function*(){return new Promise(e=>{(0,C.default)(n,(t,p)=>{if(t)return e("");e(p)})})});function f(){return s(this,null,function*(){let n=`SSV Scanner v${b.version}`,e=yield A(n);if(e){console.log(" ----------------------------------------------------------------------"),console.log(`${e||n}`),console.log(" ----------------------------------------------------------------------");for(let t of String(b.description).match(/.{1,67}/g)||[])console.log(` ${t}`);console.log(` ----------------------------------------------------------------------
`)}try{let t=new d;console.debug(yield t.execute())}catch(t){console.error("\x1B[31m",t.message)}})}f();})();
